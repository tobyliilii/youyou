<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ë™™Âêß!‰ªäÂ§©Ë™∞Â§©ËÉ°üÄÑÔ∏è</title>
  <!-- v5: water 44px, widen selects, remove per-person red packet; you bonus fixed +10 -->

  <style>
    :root{
      /* Dark Soft UI tokens */
      --bg:#0b111a;
      --surface:#0f1723;     /* card base */
      --surface2:#0d1520;    /* pressed */
      --text:#e7eefc;
      --muted:rgba(231,238,252,.65);

      --hi:rgba(255,255,255,.06);
      --lo:rgba(0,0,0,.58);
      --stroke:rgba(255,255,255,.07);

      --r-xl:26px;
      --r-lg:18px;
      --r-md:14px;
      --r-sm:12px;

      --shadow-raised:
        -10px -10px 22px var(--hi),
         10px  10px 22px var(--lo);

      --shadow-pressed:
        inset -6px -6px 12px rgba(255,255,255,.05),
        inset  6px  6px 12px rgba(0,0,0,.55);

      --shadow-small:
        -6px -6px 14px rgba(255,255,255,.045),
         6px  6px 14px rgba(0,0,0,.55);

      --accent:#4E7BFF;
      --accent2:#7CB0FF;

      --tableLine:rgba(255,255,255,.06);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(78,123,255,.16), transparent 60%),
        radial-gradient(900px 600px at 85% 25%, rgba(124,176,255,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Noto Sans TC",system-ui,sans-serif;
      -webkit-text-size-adjust:100%;
      padding-bottom:calc(18px + env(safe-area-inset-bottom));
    }

    .app{
      max-width:860px;
      margin:0 auto;
      padding:18px 16px 22px;
    }

    h1{ margin:8px 0 6px; font-size:22px; line-height:1.2; letter-spacing:.2px; }
    .muted{ color:var(--muted); font-size:13px; line-height:1.55; }

    /* ====== Soft UI surfaces ====== */
    .card{
      background:
        linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,0)),
        var(--surface);
      border:1px solid var(--stroke);
      border-radius:var(--r-xl);
      padding:24px;
      margin:14px 0;
      box-shadow:var(--shadow-raised);
    }

    /* smaller inner cards (per-round) */
    .roundCard{
      padding:18px;
      margin-top:12px;
      border-radius:20px;
      box-shadow:var(--shadow-small);
    }

    /* general form row */
    .row{
  align-items:center !important;
 display:flex; gap:14px; flex-wrap:wrap; align-items:center; }
    .row > div{
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
    }

    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:8px; letter-spacing:.2px; }

    input,select,button{
      border-radius:var(--r-md);
      font-size:16px;
      color:var(--text);
      min-height:44px;
      outline:none;
    }

    /* pressed fields */
    input,select{
      padding:12px 14px;
      border:1px solid rgba(255,255,255,.06);
      background:var(--surface2);
      box-shadow:var(--shadow-pressed);
    }
    input[type="number"], input[type="text"]{ width:160px; }

    /* buttons (raised) */
    button{
      cursor:pointer;
      background:var(--surface);
      border:1px solid rgba(255,255,255,.09);
      box-shadow:var(--shadow-raised);
      font-weight:800;
      padding:0 16px;
      transition:transform .08s ease, box-shadow .12s ease, filter .12s ease;
    }
    button:hover{ filter:brightness(1.06); }
    button:active{
      transform: translateY(1px);
      box-shadow:var(--shadow-pressed);
    }

    /* secondary/ghost buttons */
    .resetBtn,
    #clearRoundsBtn,
    .roundHeader button{
      background:transparent;
      box-shadow:none;
      border:1px solid rgba(255,255,255,.12);
    }
    .resetBtn:hover,
    #clearRoundsBtn:hover,
    .roundHeader button:hover{
      filter:none;
      background:rgba(255,255,255,.04);
    }
    .resetBtn:active,
    #clearRoundsBtn:active,
    .roundHeader button:active{
      transform: translateY(1px);
      box-shadow:var(--shadow-pressed);
      background:rgba(255,255,255,.02);
    }

    /* primary CTA (Ë®òÈåÑÊú¨Â±Ä) */
    #addRoundBtn{
  width:92px !important;
  min-width:92px !important;
  max-width:92px !important;

  width:80px;
  min-width:80px;
      background: linear-gradient(180deg, rgba(124,176,255,.24), rgba(78,123,255,.18)), var(--surface);
      border-color: rgba(78,123,255,.35);
    
}

    /* Tables: flat, clean */
    table{ width:100%; border-collapse:collapse; margin-top:12px; }
    th,td{
      border-bottom:1px solid var(--tableLine);
      padding:12px 8px;
      text-align:left;
      vertical-align:top;
    }
    th{ font-size:13px; color:var(--muted); font-weight:800; }
    tbody tr:hover{ background:rgba(255,255,255,.03); }

    .warn{ color:#ff6b6b; font-size:13px; margin-top:10px; }
    .ok{ color:#3ddc84; font-size:13px; margin-top:10px; }
    .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }

    .badge{
      display:inline-block;
      padding:2px 10px;
      border-radius:999px;
      font-size:12px;
      background:rgba(255,214,102,.10);
      color:#ffd666;
      border:1px solid rgba(255,214,102,.18);
      margin-left:8px;
      line-height:1.7;
      vertical-align:middle;
      box-shadow: -6px -6px 12px rgba(255,255,255,.04), 6px 6px 12px rgba(0,0,0,.45);
    }

    .roundHeader{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .roundTitle{ font-size:14px; line-height:1.4; }
    .roundLines{
      margin-top:12px;
      font-size:13px;
      line-height:1.6;
      word-break:break-word;
    }
    .roundHeader button{
      height:40px;
      line-height:40px;
      padding:0 12px;
      border-radius:14px;
      font-size:14px;
      white-space:nowrap;
    }

    .formRow{ align-items:flex-end; }

    /* ===== Names area ===== */
    .namesHeader{
      display:grid;
      grid-template-columns:1fr auto;
      gap:12px;
      align-items:end;
    }

    #namesRow.namesGrid{
      display:grid;
      grid-template-columns:repeat(4, minmax(0, 1fr));
      gap:14px !important;
      align-items:stretch;
    }

    #namesRow.namesGrid > div{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    #namesRow.namesGrid input{
      width:100%;
      text-align:center;
      border-radius:18px;
      padding:16px 14px;
      background:var(--surface2);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow-pressed);
    }

    /* ===== Stepper (Water) ===== */
    .stepper{
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px;
      border-radius:18px;
      background:var(--surface2);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow-pressed);
    }

    /* center 0 */
    .stepper input[type="number"]{
      height:44px;
      padding:0;
      text-align:center;
      line-height:44px;
      width:56px !important;
      min-width:56px;
      max-width:56px;
      flex:0 0 auto;
      background:transparent;
      border:0;
      box-shadow:none;
    }

    .stepper button{
      width:44px;
      height:44px;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
      border-radius:16px;
      background:var(--surface);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:var(--shadow-small);
    }
    .stepper button:active{ box-shadow:var(--shadow-pressed); }


    /* ===== Segmented (Ê∏∏Èáë ÁÑ°/Êúâ) ===== */
    .sr-only{
      position:absolute !important;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    .segmented{
      display:flex;
      gap:6px;
      padding:6px;
      border-radius:18px;
      background:var(--surface2);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow-pressed);
      min-height:44px;
    }

    .seg-btn{
      flex:1 1 0;
      height:44px;
      border-radius:14px;
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      font-weight:900;
      letter-spacing:.2px;
      box-shadow:none;
      padding:0 14px;
      transition:filter .12s ease, transform .08s ease, box-shadow .12s ease, color .12s ease, background .12s ease;
    }

    .seg-btn.is-active{
      color:var(--text);
      background:
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0)),
        var(--surface);
      border-color: rgba(255,255,255,.08);
      box-shadow: var(--shadow-small);
    }

    .segmented.is-disabled{
      opacity:.6;
      pointer-events:none;
    }

    /* ===== Select arrow (white) ===== */
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      background-image:url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>\
<path fill='white' fill-opacity='0.85' d='M6 9l6 6 6-6'/>\
</svg>");
      background-repeat:no-repeat;
      background-size:16px;
      background-position:right 12px center;
      padding-right:44px;
      text-align:center;
      text-align-last:center;
    }

    /* ===== Mobile ===== */
    @media (max-width:520px){
      .card{ padding:20px; }
      .namesHeader{
        grid-template-columns:1fr;
        gap:12px;
        align-items:stretch;
      }
      #namesRow.namesGrid{
        grid-template-columns:repeat(2, minmax(0, 1fr));
        gap:12px !important;
      }
      #resetBtn{ width:100%; justify-self:stretch; }
    }

    /* Desktop: remove number spinner ONLY for waterInput */
    @media (min-width:521px){
      #waterInput::-webkit-inner-spin-button,
      #waterInput::-webkit-outer-spin-button{
        -webkit-appearance:none;
        margin:0;
      }
      #waterInput{ -moz-appearance:textfield; }
    }

    button, select, input{ touch-action: manipulation; }

/* ===== v2 UI refinements ===== */
/* lock all controls to 44px visually */
button, select, input {
  height: 44px !important;
  line-height: 44px;
}

/* reset -> swap (secondary) */
#resetBtn{
  opacity: .55;
}

/* water compact */
.stepper{
  min-width: 120px;
}
#waterInput{
  width: 56px;
}

/* CTA grow */
#addRoundBtn{
  flex: 1;
}

/* segmented contrast */
.seg-btn{
  opacity:.45;
}
.seg-btn.is-active{
  opacity:1;
}


/* ===== v3 refinements (Second row alignment & hierarchy) ===== */

/* 1) True visual 44px baseline: use flex centering, fix select padding/line-height */
select, button, input{
  height:44px !important;
}
select{
  padding:0 14px !important;
  line-height:44px !important;
}
button{
  line-height:44px !important;
  padding:0 18px !important;
}
input{
  line-height:44px !important;
  padding:0 12px !important;
}

/* 2) Labels: bring back readable contrast (not too loud) */
.formRow label{
  color: rgba(231,238,252,.65) !important;
  margin-bottom:6px !important;
}

/* 3) Second row layout: keep tools compact, let CTA take remaining space */
.formRow > div{ min-width: unset !important; }
.formRow > div:not(:last-child){ flex:0 0 auto !important; }
.formRow > div:last-child{
  flex:1 1 320px !important;
  min-width: 240px !important;
}
#addRoundBtn{ width:100% !important; }

/* 4) Water: compact tool size */
.stepper{
  width:132px !important;
  flex:0 0 132px !important;
  height:44px !important;
}
.stepper button{
  width:44px !important;
  height:44px !important;
  padding:0 !important;
}
#waterInput{
  width:44px !important;
  padding:0 !important;
  text-align:center !important;
}

/* 5) Segmented: align height and make inactive darker */
.segmented{
  height:44px !important;
  align-items:center !important;
}
.seg-btn{ opacity:.32 !important; }
.seg-btn.is-active{ opacity:1 !important; }


/* ===== v4: single-row flow ===== */
.formRow{
  flex-wrap: nowrap !important;
  align-items: center !important;
}

/* remove vertical label space in row */
.formRow label{
  margin-bottom:2px !important;
  font-size:11px !important;
}

/* keep all controls inline */
.formRow > div{
  flex:0 0 auto !important;
}

/* water inline compact */
.stepper{
  width:120px !important;
}

/* CTA as sentence end */
.formRow > div:last-child{
  flex:1 1 auto !important;
}
#addRoundBtn{
  width:100% !important;
}


/* ===== v5: refinements (water to 44px rectangle, widen key selects) ===== */

/* Water: make it a true 44px rectangle like other inputs */
.stepper{
  padding:0 !important;
  height:44px !important;
  border-radius:14px !important;
  width:160px !important;         /* v5: rectangle width */
  flex:0 0 160px !important;
}
.stepper button{
  width:44px !important;
  height:44px !important;
  border-radius:12px !important;
}
#waterInput{
  width:72px !important;          /* give the number a bit more breathing room */
  min-width:72px !important;
  max-width:72px !important;
  height:44px !important;
}

/* Key selects: prevent text/arrow overlap */
#dealerSel, #winnerSel, #typeSel{
  width:120px !important;
  min-width:120px !important;
  max-width:120px !important;
  text-align:left !important;
  text-align-last:left !important;
  padding-left:18px !important;
  padding-right:34px !important;
}


/* Since we removed Á¥ÖÂåÖÊ¨Ñ‰Ωç, keep second row strictly single-line */
#youWhoWrap{ min-width:170px !important; }


/* ===== v5.1: align with agreed visual ===== */

/* Desktop: keep the form inputs on a single baseline without wrapping */
@media (min-width: 980px){
  .formRow{ flex-wrap:nowrap !important; }
}

/* Water stepper: ensure total height is 44 (include padding/border) */
.stepper, .stepper button, #waterInput{
  box-sizing:border-box !important;
}
.stepper{
  padding:0 !important;
  height:44px !important;
  min-height:44px !important;
  border-radius:14px !important;
  width:150px !important;
  flex:0 0 150px !important;
  gap:0 !important;
}
.stepper button{
  width:44px !important;
  height:44px !important;
  border-radius:12px !important;
}
#waterInput{
  height:44px !important;
  width:62px !important;
  min-width:62px !important;
  max-width:62px !important;
}

/* Read-only pill for Ê∏∏Èáë */
.pill{
  transition: transform .12s ease, filter .12s ease;

  display:flex;
  align-items:center;
  justify-content:center;
  height:44px;
  min-height:44px;
  padding:0 16px;
  border-radius:18px;
  background:var(--surface2);
  border:1px solid rgba(255,255,255,.06);
  box-shadow:var(--shadow-pressed);
  color:var(--text);
  font-weight:700;
  letter-spacing:.02em;
  min-width:92px;
}
.pill.is-on{ filter:brightness(1.08); }


/* ===== v5.2: tighten widths + hard-fix water stepper square issue ===== */
.stepper-water{
  display:flex !important;
  align-items:center !important;
  justify-content:space-between !important;
  height:44px !important;
  min-height:44px !important;
  max-height:44px !important;
  width:120px !important;
  min-width:120px !important;
  max-width:120px !important;
  padding:0 !important;
  box-sizing:border-box !important;
  overflow:hidden !important;
  flex:0 0 auto !important;
  align-self:center !important;
}

.stepper-water button{
  width:30px !important;
  height:44px !important;
  padding:0 !important;
  border-radius:10px !important;
}
.stepper-water #waterInput{
  width:40px !important;
  min-width:40px !important;
  max-width:40px !important;
  height:44px !important;
  line-height:44px !important;
  padding:0 !important;
  text-align:center !important;
}


/* v5.6: center key selects */
#dealerSel, #winnerSel, #typeSel{
  width:100px !important;
  min-width:100px !important;
  text-align:center !important;
  text-align-last:center !important;
  padding-left:12px !important;
  padding-right:30px !important;
}


/* v5.7: center text but visually offset left (compensate ‚ñº arrow) */
#dealerSel, #winnerSel, #typeSel{
  width:100px !important;
  min-width:100px !important;
  text-align:center !important;
  text-align-last:center !important;
  padding-left:12px !important;
  padding-right:30px !important;
}


/* v5.11: micro interaction for record button */
#addRoundBtn{
  transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease;
}
#addRoundBtn:active{
  transform: translateY(1px) scale(0.985);
  box-shadow: 0 2px 8px rgba(0,0,0,.35) inset;
}
#addRoundBtn.success{
  filter: brightness(1.08);
}


/* v5.12: desktop override - keep record button compact */
@media (min-width: 900px){
  #addRoundBtn{
    width:80px !important;
    min-width:80px !important;
    max-width:80px !important;
    flex:0 0 80px !important;
  }
}


/* v5.13: lock record button shape (no square) */
#addRoundBtn{
  display:inline-flex !important;
  align-items:center !important;
  justify-content:center !important;
  height:44px !important;
  min-height:44px !important;
  max-height:44px !important;
  white-space:nowrap !important;
  align-self:center !important;
}


/* v5.15 FINAL: absolute CTA width override */
.record-row button#addRoundBtn{
  width:92px !important;
  min-width:92px !important;
  max-width:92px !important;
  flex:0 0 92px !important;
}




.water-value{ flex:1; text-align:center; }

/* v6.1: reduce empty space on the right by letting CTA grow */
#addRoundBtn{
  flex:1 1 auto !important;
  width:auto !important;
  min-width:180px !important;
  max-width:320px !important;
  height:44px !important;
  min-height:44px !important;
  max-height:44px !important;
  white-space:nowrap !important;
  display:inline-flex !important;
  align-items:center !important;
  justify-content:center !important;
}




/* v6.2: CTA fills remaining space in the row (no empty right side) */
.row.formRow{ align-items:flex-end; flex-wrap:nowrap; }
.row.formRow > div{ flex:0 0 auto; }
.row.formRow > div:last-child{ flex:1 1 auto; display:flex; }
#addRoundBtn{
  width:100% !important;
  height:44px !important;
  min-height:44px !important;
  max-height:44px !important;
  min-width:240px !important;
  max-width:none !important;
  white-space:nowrap !important;
  display:inline-flex !important;
  align-items:center !important;
  justify-content:center !important;
}


/* ===== v7.3: keep record icon INSIDE the row + flip pencil tip to LEFT ===== */

/* Names label tight (keep your perfect left section) */
#namesRow.namesGrid > div{ gap:4px !important; }
#namesRow.namesGrid label{
  margin-bottom:2px !important;
  font-size:11px !important;
  line-height:1.2 !important;
}

/* Main controls: fill more, but keep CTA in-row */
#dealerSel, #winnerSel, #typeSel{
  width:170px !important;
  min-width:170px !important;
  max-width:170px !important;
}
.stepper-water{
  width:150px !important;
  min-width:150px !important;
  max-width:150px !important;
}

/* CRITICAL: stop the last column from taking 100% width (older v6.2 rules) */
.row.formRow > div:last-child{
  flex:0 0 auto !important;
  display:flex !important;
  margin-left:auto !important;  /* push icon to the far right, but stay inside */
  min-width:auto !important;
}

/* Icon-only record button sizing */
#addRoundBtn{
  width:64px !important;
  min-width:64px !important;
  max-width:64px !important;
  height:44px !important;
  padding:0 !important;
  flex:0 0 auto !important;
  display:inline-flex !important;
  align-items:center !important;
  justify-content:center !important;
  white-space:nowrap !important;
}
#addRoundBtn svg{ display:block !important; }


/* ===== v9: Mobile layout polish (<=520px) ===== */
@media (max-width:520px){

  /* Second card: allow wrapping into a clean grid */
  .row.formRow{
    flex-wrap:wrap !important;
    gap:12px !important;
    align-items:flex-end !important;
  }

  /* 2-column grid for controls */
  .row.formRow > div{
    flex:1 1 calc(50% - 12px) !important;
    min-width:0 !important;
  }

  /* Make selects/stepper fill their cells */
  #dealerSel, #winnerSel, #typeSel{
    width:100% !important;
    min-width:0 !important;
    max-width:none !important;
  }
  .stepper-water{
    width:100% !important;
    min-width:0 !important;
    max-width:none !important;
  }

  /* Record button: full-width last row (still icon-only) */
  .row.formRow > div:last-child{
    flex:1 1 100% !important;
    margin-left:0 !important;
  }
  #addRoundBtn{
    width:100% !important;
    min-width:0 !important;
    max-width:none !important;
  }

  /* Optional: slightly larger tap target feel */
  button, select, input{
    height:46px !important;
    line-height:46px !important;
  }
  .stepper-water button{
    height:46px !important;
  }
  .stepper-water #waterInput{
    height:46px !important;
    line-height:46px !important;
  }
}


/* ===== v10: Third column mobile-friendly round cards ===== */
:root{
  --youGold:#f5d24a;
}
.roundCard{
  border:1px solid rgba(255,255,255,.08);
}
.roundCard.isYoujin{
  border:2px solid var(--youGold);
}
.roundHeader{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.roundDelBtn{
  width:54px;
  height:54px;
  border-radius:16px;
  border:2px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.04);
  color: rgba(255,255,255,.92);
  display:flex;
  align-items:center;
  justify-content:center;
  flex:0 0 auto;
}
.roundDelBtn:active{ transform: scale(.98); }

.roundTitle .rTop{
  font-weight:700;
  color: rgba(255,255,255,.55);
  letter-spacing:.2px;
}
.roundTitle .rIdx{ margin-right:6px; color: rgba(255,255,255,.45); }
.roundTitle .rMain{
  margin-top:10px;
  font-size:34px;
  font-weight:900;
  letter-spacing:.2px;
  color: rgba(255,255,255,.96);
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:10px;
}
.roundTitle .rWinner{ font-weight:900; }
.roundTitle .rSep{ opacity:.55; font-weight:800; }
.roundTitle .rWater{ font-weight:900; }
.roundTitle .rDot{ opacity:.55; }
.roundTitle .rType{ font-weight:900; }

.youBadge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
  border:2px solid rgba(245,210,74,.35);
  background: rgba(245,210,74,.10);
  color: rgba(255,255,255,.90);
  font-size:16px;
  font-weight:800;
  margin-left:2px;
}
.youDot{
  width:12px;
  height:12px;
  border-radius:999px;
  background: var(--youGold);
  box-shadow: 0 0 0 4px rgba(245,210,74,.18);
}
.roundTitle .rSub{
  margin-top:14px;
  font-size:22px;
  font-weight:800;
  color: rgba(255,255,255,.45);
}

/* Desktop keeps detailed lines visible */
.roundLinesDesktop{ margin-top:14px; }

/* Mobile tune: hide the old ultra-detailed lines; keep summary only */
@media (max-width:520px){
  .roundLinesDesktop{
    display:none !important;
  }
  .roundCard{
    padding:22px 22px !important;
    border-radius:34px !important;
  }
}


/* ===== v11 (fix): Mobile third column polish ===== */
@media (max-width:520px){

  /* Header layout: keep tools centered on the card's main axis */
  .roundHeader{
    align-items:center !important;
  }
  .roundTitle{
    min-width:0 !important;
  }

  /* 1) Youjin badge -> octagon icon only (no text) */
  .youBadge{
    padding:0 !important;
    width:30px !important;
    height:30px !important;
    border-radius:10px !important;
    border:1px solid rgba(255, 210, 64, 0.35) !important;
    background: rgba(255, 210, 64, 0.10) !important;
    display:inline-flex !important;
    align-items:center !important;
    justify-content:center !important;
    gap:0 !important;
    font-size:0 !important; /* hide text width */
    line-height:0 !important;
    white-space:nowrap !important;
    vertical-align:middle !important;
  }
  .youBadge .youDot{ display:none !important; }

  .youBadge::before{
    content:"";
    width:18px;
    height:18px;
    display:block;
    background:#FFD240;
    clip-path: polygon(
      30% 0%,
      70% 0%,
      100% 30%,
      100% 70%,
      70% 100%,
      30% 100%,
      0% 70%,
      0% 30%
    );
  }

  /* 2) Trash button bigger + centered */
  .roundDelBtn{
    width:56px !important;
    height:56px !important;
    border-radius:16px !important;
    display:flex !important;
    align-items:center !important;
    justify-content:center !important;
    align-self:center !important;
    flex:0 0 auto !important;
  }
  .roundDelBtn svg{
    width:26px !important;
    height:26px !important;
  }
}


/* ===== v11.3: Youjin = octagon only (no pill) + bigger trash ===== */
@media (max-width:520px){

  /* Youjin: remove container visuals, keep only octagon */
  .youBadge{
    width:auto !important;
    height:auto !important;
    padding:0 !important;
    border:none !important;
    background:transparent !important;
    box-shadow:none !important;
    border-radius:0 !important;
    font-size:0 !important;
    line-height:0 !important;
  }
  .youBadge span{ display:none !important; }
  .youBadge .youDot{ display:none !important; }

  .youBadge::before{
    width:22px !important;
    height:22px !important;
    background:#FFD240 !important;
  }

  /* Trash: bigger button + bigger icon */
  .roundDelBtn{
    width:64px !important;
    height:64px !important;
    border-radius:18px !important;
  }
  .roundDelBtn svg{
    width:30px !important;
    height:30px !important;
  }
}


/* ===== PATCH (B): no localStorage + centered trash (desktop & mobile) + youjin icon only ===== */

/* Trash: always center icon, all breakpoints */
.roundDelBtn{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  padding:0 !important;
  line-height:0 !important;
}
.roundDelBtn svg{
  display:block !important;
  margin:0 !important;
}

/* Youjin badge: octagon only (remove text) */
.youBadge{
  width:auto !important;
  height:auto !important;
  padding:0 !important;
  border:none !important;
  background:transparent !important;
  box-shadow:none !important;
  border-radius:0 !important;
  font-size:0 !important;
  line-height:0 !important;
}
.youBadge span,
.youBadge .youDot{ display:none !important; }
.youBadge::before{
  content:"";
  width:22px !important;
  height:22px !important;
  display:inline-block;
  background:#FFD240 !important;
  clip-path: polygon(
    30% 0%,
    70% 0%,
    100% 30%,
    100% 70%,
    70% 100%,
    30% 100%,
    0% 70%,
    0% 30%
  );
}


/* ===== PATCH vB4: Trash center + bigger sizes (desktop & mobile) ===== */
.roundDelBtn{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  align-self:center !important;
  padding:0 !important;
  margin:0 !important;
  line-height:0 !important;

  width:76px !important;   /* desktop a bit bigger */
  height:76px !important;
  border-radius:20px !important;
}
.roundDelBtn svg{
  display:block !important;
  width:36px !important;
  height:36px !important;
  margin:0 !important;
}

/* Mobile: make it bigger + keep perfectly centered */
@media (max-width:520px){
  .roundDelBtn{
    width:88px !important;
    height:88px !important;
    border-radius:24px !important;
  }
  .roundDelBtn svg{
    width:42px !important;
    height:42px !important;
  }
}


/* ===== PATCH vB5: Desktop header vertical centering (trash truly centered) ===== */
.roundHeader{
  align-items:center !important;  /* override older flex-start */
}
.roundTitle{
  padding-top:0 !important;
  padding-bottom:0 !important;
}


/* ===== PATCH vB7: Pin trash button absolute center (desktop+mobile) ===== */
.roundHeader{
  position:relative !important;
  align-items:stretch !important; /* let title define height */
}
.roundDelBtn{
  position:absolute !important;
  right:0 !important;
  top:50% !important;
  transform: translateY(-50%) !important;

  display:flex !important;
  align-items:center !important;
  justify-content:center !important;

  padding:0 !important;
  margin:0 !important;
  line-height:0 !important;
}

/* keep icon dead-center */
.roundDelBtn svg{ display:block !important; margin:0 !important; }

/* sizing: desktop */
.roundDelBtn{
  width:76px !important;
  height:76px !important;
  border-radius:20px !important;
}
.roundDelBtn svg{
  width:36px !important;
  height:36px !important;
}

/* mobile sizing */
@media (max-width:520px){
  .roundDelBtn{
    width:88px !important;
    height:88px !important;
    border-radius:24px !important;
  }
  .roundDelBtn svg{
    width:42px !important;
    height:42px !important;
  }
}


/* ===== PATCH vB8: Center trash relative to WHOLE round card ===== */
.roundCard{ position:relative !important; }
.roundHeader{ position:static !important; } /* don't be positioning context */
.roundDelBtn{
  position:absolute !important;
  right:24px !important;   /* a bit inset from card edge */
  top:50% !important;      /* center within the entire card */
  transform:translateY(-50%) !important;
}
@media (max-width:520px){
  .roundDelBtn{ right:18px !important; }
}


/* ===== PATCH vB9: Mobile tune (trash smaller, thinner border, typography down) ===== */
@media (max-width:520px){
  /* Trash: a bit smaller + border thinner */
  .roundDelBtn{
    width:72px !important;
    height:72px !important;
    border-radius:22px !important;
    border-width:0px !important; /* we'll set exact border below */
  }
  /* original border is 2px; make it 0 then reapply 0? better: set 1px */
  .roundDelBtn{
    border:1px solid rgba(255,255,255,.18) !important;
  }
  .roundDelBtn svg{
    width:34px !important;
    height:34px !important;
  }

  /* Main summary line: A - 0Ê∞¥ ¬∑ ËÉ°Áâå (down 2 steps) */
  .roundTitle .rMain{
    font-size:28px !important;
    gap:8px !important;
  }

  /* Sub line: ËéäÂÆ∂xx/Âπ≥ÂÆ∂xx smaller */
  .roundTitle .rSub{
    font-size:16px !important;
    margin-top:10px !important;
  }
}


/* ===== PATCH vB10: Mobile tables keep first column visible ===== */
@media (max-width:520px){
  table{ table-layout:fixed !important; }
  th,td{ overflow:hidden; text-overflow:ellipsis; }
  th:first-child, td:first-child{
    width:72px !important;
    min-width:72px !important;
    white-space:nowrap !important;
  }
}


/* ===== PATCH vB11: iOS-ish interactions + youjin soft glow + mobile title spacing ===== */

/* --- Trash button: subtle glow on hover/tap --- */
.roundDelBtn{
  transition: transform .12s ease, box-shadow .18s ease, background-color .18s ease, border-color .18s ease, opacity .18s ease;
  -webkit-tap-highlight-color: transparent;
}
.roundDelBtn:hover{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.24) !important;
  box-shadow:
    0 10px 22px rgba(0,0,0,.45),
    0 0 0 1px rgba(255,255,255,.06) inset;
}
.roundDelBtn:active{
  transform: scale(.96) !important;
  background: rgba(255,255,255,.08) !important;
  border-color: rgba(255,255,255,.28) !important;
  box-shadow:
    0 8px 18px rgba(0,0,0,.55),
    0 0 0 1px rgba(255,255,255,.10) inset;
}

/* --- Youjin badge: soft outer glow --- */
.youBadge::before{
  box-shadow:
    0 0 0 1px rgba(255,210,64,.25) inset,
    0 6px 16px rgba(255,210,64,.20),
    0 0 22px rgba(255,210,64,.16);
}

/* --- Youjin card: reduce hard border, use glow instead --- */
.roundCard.isYoujin{
  border-color: rgba(255,210,64,.55) !important;
  box-shadow:
    -10px -10px 22px rgba(255,255,255,.06),
     10px  10px 22px rgba(0,0,0,.58),
     0  0  0  1px rgba(255,210,64,.14) inset,
     0  10px 26px rgba(255,210,64,.10),
     0  0  34px rgba(255,210,64,.10);
}

/* --- Mobile: title line spacing more native --- */
@media (max-width:520px){
  .roundTitle .rMain{
    line-height: 1.08 !important;
    letter-spacing: .2px !important;
  }
  .roundTitle .rSub{
    line-height: 1.15 !important;
  }
}


/* ===== PATCH vB12: Mobile trash frame smaller (requested) ===== */
@media (max-width:520px){
  .roundDelBtn{
    width:58px !important;
    height:58px !important;
    border-radius:16px !important;
    border-width:1px !important;
  }
  .roundDelBtn svg{
    width:28px !important;
    height:28px !important;
  }
}


/* ===== PATCH vB13: Winner line typography (bold name + lighter meta) + adaptive sizing + smart wrap + youjin tighten ===== */

/* Base: separate emphasis */
.rMain .rWinner{ font-weight:900; }
.rMain .rSep,
.rMain .rDot{ opacity:.55; }
.rMain .rWater,
.rMain .rType{ font-weight:750; opacity:.95; }

/* Make layout wrap gracefully when name is long */
.rMain{
  display:flex;
  flex-wrap:wrap;
  align-items:baseline;
  gap:10px;
}
.rMain .rWinner{
  min-width:0;        /* allow flex shrink */
  flex:0 1 auto;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap; /* keep name in one line; if too long, ellipsis */
}
.rMain .rSep,
.rMain .rWater,
.rMain .rDot,
.rMain .rType,
.rMain .youBadge{
  flex:0 0 auto;
}

/* If it wraps, keep second line a bit tighter */
.rMain{ row-gap:8px; }

/* Mobile: adaptive sizing + more native spacing */
@media (max-width:520px){
  .roundTitle .rMain{
    font-size:clamp(24px, 6.2vw, 26px) !important; /* down a touch, adaptive */
    line-height:1.10 !important;
    letter-spacing:0.15px !important;
    gap:8px !important;
    row-gap:6px !important;
  }

  /* Meta slightly smaller than name */
  .roundTitle .rMain .rWater,
  .roundTitle .rMain .rType{
    font-size:.92em !important;
    font-weight:700 !important;
  }

  /* Dots/seps slightly smaller */
  .roundTitle .rMain .rSep,
  .roundTitle .rMain .rDot{
    font-size:.90em !important;
  }

  /* Smart wrap: if name takes space, meta can go next line without feeling loose */
  .roundTitle .rMain .rWinner{
    max-width:100%;
  }

  /* Sub info smaller + tighter */
  .roundTitle .rSub{
    font-size:15px !important;
    line-height:1.12 !important;
    margin-top:10px !important;
  }
}

/* Youjin: tighten tracking a bit so it feels more ‚Äúnative‚Äù */
.roundCard.isYoujin .rMain{
  letter-spacing:0.05px;
}


/* ===== PATCH vB14: Auto adjust title tracking by winner name length ===== */
.roundTitle .rMain{
  letter-spacing: var(--titleTrack, 0.15px);
}


/* ===== PATCH vB15: mobile rMain smaller + trash frame smaller ===== */
@media (max-width:520px){
  .roundTitle .rMain{
    font-size:clamp(22px, 5.8vw, 24px) !important; /* smaller by ~1 step */
    line-height:1.08 !important;
    gap:6px !important;
    row-gap:6px !important;
  }

  /* Trash frame smaller */
  .roundDelBtn{
    width:54px !important;
    height:54px !important;
    border-radius:14px !important;
    border:1px solid rgba(255,255,255,.14) !important;
  }
  .roundDelBtn svg{
    width:26px !important;
    height:26px !important;
  }
}


/* ===== PATCH vB16: hide round detail lines (kept in DOM, not rendered) ===== */
.roundLines{
  display:none !important;
}


/* ===== PATCH vB17: Desktop tables - tighten last column & improve alignment ===== */
#totalsArea table,
#transfersArea table{
  width:100%;
  table-layout:fixed;
}

#totalsArea th:nth-child(1),
#totalsArea td:nth-child(1){
  width:200px;
}
#totalsArea th:nth-child(2),
#totalsArea td:nth-child(2){
  text-align:right;
  width:220px;
}

#transfersArea th:nth-child(1),
#transfersArea td:nth-child(1){
  width:180px;
}
#transfersArea th:nth-child(2),
#transfersArea td:nth-child(2){
  width:60px;
  text-align:center;
}
#transfersArea th:nth-child(3),
#transfersArea td:nth-child(3){
  width:auto;
}
#transfersArea th:nth-child(4),
#transfersArea td:nth-child(4){
  width:160px;
  text-align:right;
}

#totalsArea td,
#transfersArea td{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Keep mobile locked columns behavior; only apply tighter spacing on wider screens */
@media (min-width:900px){
  #totalsArea th, #totalsArea td,
  #transfersArea th, #transfersArea td{
    padding-top:16px;
    padding-bottom:16px;
  }
}


/* ===== FINAL: Áé©ÂÆ∂Âç°ÁâàÈù¢ÔºàÊ°åÊ©ü 4 / ÊâãÊ©ü 2x2Ôºâ ===== */
#namesRow.namesGrid{
  display:grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap:14px !important;
}
@media (max-width:520px){
  #namesRow.namesGrid{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap:12px !important;
  }
}



/* ===== FINAL v2: Á∏ΩË®àÊîπÊàêÁé©ÂÆ∂Âç°ÔºàÊ°åÊ©ü 4 / ÊâãÊ©ü 2x2ÔºâÔºåËΩâÂ∏≥Ê∏ÖÂñÆÁ∂≠ÊåÅÂàóË°® ===== */
.totalsGrid{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap:14px;
  margin-top:14px;
}
@media (max-width:520px){
  .totalsGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px; }
}
.playerTotalCard{
  background:
    linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,0)),
    var(--surface);
  border:1px solid rgba(255,255,255,.08);
  border-radius:22px;
  padding:16px 16px;
  box-shadow: var(--shadow-small);
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width:0;
}
.playerTotalTop{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
}
.playerName{
  font-weight:900;
  font-size:16px;
  letter-spacing:.2px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.playerAmt{
  font-weight:900;
  font-size:18px;
  letter-spacing:.2px;
  text-align:right;
}
.playerMeta{
  color: rgba(231,238,252,.55);
  font-size:12px;
  line-height:1.35;
}
.playerAmt.pos{ color: rgba(61,220,132,.95); }
.playerAmt.neg{ color: rgba(255,107,107,.95); }



/* ===== vNext: ÁµêÁÆóÂç°ÔºàË¥èÂÆ∂Á∏ΩË¶Ω + ËΩâÂ∏≥Âç°Ôºâ ===== */
.settleGrid{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap:14px;
  margin-top:14px;
}
@media (max-width:520px){
  .settleGrid{
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:12px;
  }
}

/* Base card */
.settleCard{
  background:
    radial-gradient(120% 160% at 20% 0%, rgba(255,255,255,.06), rgba(255,255,255,0) 55%),
    linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)),
    var(--surface);
  border:1px solid rgba(255,255,255,.08);
  border-radius:22px;
  padding:16px 18px;
  box-shadow: var(--shadow-small);
  min-width:0;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  gap:10px;
}

/* Winner highlight */
.settleCard.is-winner{
  border-color: rgba(255,210,64,.45);
  background:
    radial-gradient(120% 160% at 20% 0%, rgba(255,210,64,.18), rgba(255,210,64,0) 60%),
    linear-gradient(180deg, rgba(255,210,64,.12), rgba(255,255,255,0)),
    var(--surface);
  box-shadow:
    -10px -10px 22px rgba(255,255,255,.06),
     10px  10px 22px rgba(0,0,0,.58),
     0  0  0  1px rgba(255,210,64,.14) inset,
     0  10px 26px rgba(255,210,64,.10),
     0  0  34px rgba(255,210,64,.10);
}

.settleTop{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
}
.settleName{
  font-weight:900;
  letter-spacing:.2px;
  min-width:0;
  overflow-wrap:anywhere;
}
@media (max-width:520px){
  .settleName{
    /* ÊâãÊ©üÔºöÂêçÂ≠óÂèØËÉΩÂæàÈï∑ÔºåÂÖÅË®±ÊèõË°å‰∏¶Ëá™ÂãïÁ∏ÆÂ≠ó */
    white-space:normal;
    line-height:1.1;
    font-size: clamp(13px, 4.2vw, 18px);
  }
}
@media (min-width:521px){
  .settleName{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    font-size:18px;
  }
}
.settleAmt{
  font-weight:950;
  font-size:22px;
  letter-spacing:.2px;
  text-align:right;
}
.settleAmt.pos{ color: rgba(61,220,132,.95); }
.settleAmt.neg{ color: rgba(255,107,107,.95); }

.settleMeta{
  color: rgba(231,238,252,.55);
  font-size:12px;
  line-height:1.35;
  display:flex;
  align-items:center;
  gap:8px;
  min-height:16px;
}

/* Small gold badge (for youjin amount) */
.youjinMini{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,210,64,.26);
  background: rgba(255,210,64,.08);
  color: rgba(231,238,252,.85);
  font-weight:800;
}
.youjinIcon{
  width:14px;
  height:14px;
  display:inline-block;
  background:#FFD240;
  clip-path: polygon(30% 0%,70% 0%,100% 30%,100% 70%,70% 100%,30% 100%,0% 70%,0% 30%);
  box-shadow:
    0 0 0 1px rgba(255,210,64,.22) inset,
    0 6px 14px rgba(255,210,64,.14);
}

/* Transfer card */
.transferLine{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.transferWho{
  font-weight:900;
  font-size:18px;
  color: rgba(231,238,252,.88);
  letter-spacing:.2px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.transferArrow{
  opacity:.55;
  font-weight:900;
}
.transferAmt{
  font-weight:950;
  font-size:22px;
  letter-spacing:.2px;
  color: rgba(255,107,107,.95);
  text-align:right;
}
.transferSub{
  color: rgba(231,238,252,.50);
  font-size:12px;
  line-height:1.35;
}


@media (max-width:520px){
  .settleTop{ align-items:flex-start; }
}

</style>
</head>

<body>
  <div class="app">
    <h1>Ë™™Âêß!‰ªäÂ§©Ë™∞Â§©ËÉ°üÄÑÔ∏è</h1>

    <div class="card">
      <div class="namesHeader">
        <div id="namesRow" class="namesGrid"></div>
        <button id="resetBtn" class="resetBtn">Êèõ‰∫∫</button>
      </div>
    </div>

    <div class="card">
      <div class="row formRow">
        <div>
          <label>ËéäÂÆ∂</label>
          <select id="dealerSel"></select>
        </div>

        <div>
          <label>Ë¥èÂÆ∂</label>
          <select id="winnerSel"></select>
        </div>

        <div>
          <label>Ë¥èÊ≥ï</label>
          <select id="typeSel">
            <option value="dao">ËÉ°Áâå</option>
            <option value="zimo">Ëá™Êë∏</option>
            <option value="danyou">ÂñÆÊ∏∏</option>
            <option value="shuangyou">ÈõôÊ∏∏</option>
          </select>
        </div>

        <div>
          <label>Ê∞¥</label>
          <div class="stepper stepper-water">
            <button type="button" id="waterMinus">‚àí</button>
            <input id="waterInput" type="number" value="0" min="0" max="12" inputmode="numeric" />
            <button type="button" id="waterPlus">Ôºã</button>
          </div>
        </div>
        <!-- v5.7: Ê∏∏ÈáëÁî±Ë¥èÊ≥ïËá™ÂãïÂà§Êñ∑ÔºõUI ‰∏çÈ°ØÁ§∫Ôºà‰ªç‰øùÁïôÈö±Ëóè select ‰æõÈÇèËºØ‰ΩøÁî®Ôºâ -->
        <select id="youSel" class="sr-only" aria-hidden="true" tabindex="-1">
          <option value="none" selected>ÁÑ°</option>
          <option value="yes">Êúâ</option>
        </select>
<div>
          <label>&nbsp;</label>
          <button id="addRoundBtn" aria-label="Ë®òÈåÑÊú¨Â±Ä" title="Ë®òÈåÑÊú¨Â±Ä"><svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" style="display:block;">
  <!-- one-piece solid silhouette -->
  <path fill="#ffffff" d="M3 21l6-2 12-12-5-5L4 14l-1 7z"/>
</svg></button>
        </div>
      </div>
    </div>

    <div class="card">
      <strong>Êú¨Â±ÄÁ¥ÄÈåÑ</strong>
      <div id="roundList" style="margin-top:10px;"></div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div><strong>Á∏ΩË®à</strong></div>
        <div><button id="clearRoundsBtn">Ê∏ÖÁ©∫ÂÖ®ÈÉ®Â±ÄÊï∏</button></div>
      </div>
      <div id="totalsArea"></div>
      <div id="transfersArea" style="display:none"></div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const LOOKUP = {
    dao: {
      0:{Â∫Ñ:16, Âπ≥:8},  1:{Â∫Ñ:17, Âπ≥:9},  2:{Â∫Ñ:18, Âπ≥:10}, 3:{Â∫Ñ:19, Âπ≥:11},
      4:{Â∫Ñ:20, Âπ≥:12}, 5:{Â∫Ñ:21, Âπ≥:13}, 6:{Â∫Ñ:22, Âπ≥:14}, 7:{Â∫Ñ:23, Âπ≥:15},
      8:{Â∫Ñ:24, Âπ≥:16}, 9:{Â∫Ñ:25, Âπ≥:17}, 10:{Â∫Ñ:26, Âπ≥:18}, 11:{Â∫Ñ:27, Âπ≥:19}, 12:{Â∫Ñ:28, Âπ≥:20}
    },
    zimo: {
      0:{Â∫Ñ:32, Âπ≥:16}, 1:{Â∫Ñ:34, Âπ≥:18}, 2:{Â∫Ñ:36, Âπ≥:20}, 3:{Â∫Ñ:38, Âπ≥:22},
      4:{Â∫Ñ:40, Âπ≥:24}, 5:{Â∫Ñ:42, Âπ≥:26}, 6:{Â∫Ñ:44, Âπ≥:28}, 7:{Â∫Ñ:46, Âπ≥:30},
      8:{Â∫Ñ:48, Âπ≥:32}, 9:{Â∫Ñ:50, Âπ≥:34}, 10:{Â∫Ñ:52, Âπ≥:36}, 11:{Â∫Ñ:54, Âπ≥:38}, 12:{Â∫Ñ:56, Âπ≥:40}
    },
    danyou: {
      1:{Â∫Ñ:68, Âπ≥:36}, 2:{Â∫Ñ:72, Âπ≥:40}, 3:{Â∫Ñ:76, Âπ≥:44}, 4:{Â∫Ñ:80, Âπ≥:48},
      5:{Â∫Ñ:84, Âπ≥:52}, 6:{Â∫Ñ:88, Âπ≥:56}, 7:{Â∫Ñ:92, Âπ≥:60}, 8:{Â∫Ñ:96, Âπ≥:64},
      9:{Â∫Ñ:100, Âπ≥:68}, 10:{Â∫Ñ:104, Âπ≥:72}, 11:{Â∫Ñ:108, Âπ≥:76}, 12:{Â∫Ñ:112, Âπ≥:80}
    },
    shuangyou: {
      1:{Â∫Ñ:136, Âπ≥:72}, 2:{Â∫Ñ:144, Âπ≥:80}, 3:{Â∫Ñ:152, Âπ≥:88}, 4:{Â∫Ñ:160, Âπ≥:96},
      5:{Â∫Ñ:168, Âπ≥:104}, 6:{Â∫Ñ:176, Âπ≥:112}, 7:{Â∫Ñ:184, Âπ≥:120}, 8:{Â∫Ñ:192, Âπ≥:128},
      9:{Â∫Ñ:200, Âπ≥:136}, 10:{Â∫Ñ:208, Âπ≥:144}, 11:{Â∫Ñ:216, Âπ≥:152}, 12:{Â∫Ñ:224, Âπ≥:160}
    }
  };

  let players = ["A","B","C","D"];

const START_STACK = 100; // ÊØèÂ±ÄÊØè‰∫∫Ëµ∑Âßã 100

function simulateGameState(){
  // Áî®ÁõÆÂâç rounds ÈáçÊñ∞Ê®°Êì¨‰∏ÄÈÅçÔºà‰ª•Â∑≤Ë®òÈåÑÁöÑÂØ¶‰ªòÈáëÈ°çÁÇ∫Ê∫ñÔºâ
  const n = players.length;
  const remain = Array(n).fill(START_STACK);
  let bustedIdx = null;

  rounds.forEach(r=>{
    r.lines.forEach(L=>{
      // ‰øùÈö™Â∞ÅÈ†ÇÔºàÈÅøÂÖç remain ËÆäË≤†Ôºâ
      const pay = Math.min(L.amount, remain[L.from]);
      if (pay <= 0) return;
      remain[L.from] -= pay;
      remain[L.to]   += pay;
    });
    if (bustedIdx == null){
      const idx = remain.findIndex(v => v <= 0);
      if (idx !== -1) bustedIdx = idx;
    }
  });

  return { remain, bustedIdx };
}

function setRoundLocked(isLocked, reasonText=""){
  const btn = document.getElementById("addRoundBtn");
  if(btn){
    btn.disabled = !!isLocked;
    btn.style.opacity = isLocked ? "0.55" : "";
    btn.style.cursor = isLocked ? "not-allowed" : "";
    btn.title = isLocked ? (reasonText || "Êú¨Â±ÄÂ∑≤ÁµêÁÆó") : "";
  }
}

  let rounds = [];
  let youForcedByType = false;

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  }
  function fmtMoney(x){
    const n = Math.round((x + Number.EPSILON) * 100) / 100;
    return n.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:2});
  }
  function buildOptions(sel){
    sel.innerHTML = players.map((p,i)=>`<option value="${i}">${escapeHtml(p)}</option>`).join("");
  }

  function renderNames(){
    if (!Array.isArray(players) || players.length !== 4) players = ["A","B","C","D"];
    $("namesRow").innerHTML = players.map((p,i)=>`
      <div>
        <label>Áé©ÂÆ∂ ${i+1}</label>
        <input type="text" value="${escapeHtml(p)}" data-name="${i}">
      </div>
    `).join("");

    document.querySelectorAll("[data-name]").forEach(inp=>{
      inp.addEventListener("input",(e)=>{
        const i = Number(e.target.dataset.name);
        players[i] = e.target.value || `Áé©ÂÆ∂${i+1}`;
        renderSelectors();
        renderAll();
      });
    });
  }

  function toggleYouUI(){
    // v5.5: Ê∏∏ÈáëËÄÖÂõ∫ÂÆöÁÇ∫Ë¥èÂÆ∂ÔºåÁÑ°ÈúÄÈÅ∏Êìá
    syncYouSegmented();
    syncYouSegmentedDisabled();
  }


  // ===== Segmented control for Ê∏∏Èáë (ÁÑ°/Êúâ) =====
  function syncYouSegmented(){
    const seg = $("youSeg");
    if (!seg) return;
    const v = $("youSel").value;
    seg.querySelectorAll(".seg-btn").forEach(btn=>{
      const active = (btn.dataset.value === v);
      btn.classList.toggle("is-active", active);
      btn.setAttribute("aria-selected", active ? "true" : "false");
    });
  }

  function syncYouSegmentedDisabled(){
    const seg = $("youSeg");
    if (!seg) return;
    seg.classList.toggle("is-disabled", !!$("youSel").disabled);
  }


  function updateYouPill(){
    const pill = $("youPill");
    if (!pill) return;
    const v = $("youSel")?.value;
    pill.textContent = (v === "yes") ? "Êúâ" : "ÁÑ°";
    pill.classList.toggle("is-on", v === "yes");
  }

  function setYouValue(v){
    const sel = $("youSel");
    if (!sel) return;
    if (sel.value === v) return;
    sel.value = v;
    // trigger existing change handlers
    sel.dispatchEvent(new Event("change", { bubbles: true }));
    updateYouPill();
  }

  function initYouSegmented(){
    const seg = $("youSeg");
    if (!seg) return;
    seg.querySelectorAll(".seg-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        if ($("youSel").disabled) return;
        setYouValue(btn.dataset.value);
      });
    });
    syncYouSegmented();
    syncYouSegmentedDisabled();
  }


  function renderSelectors(){
    buildOptions($("dealerSel"));
    buildOptions($("winnerSel"));
$("dealerSel").value = "0";
    $("winnerSel").value = "0";
toggleYouUI();
  }

  function lookupAmount({ type, water, dealerRate }){
  const row = LOOKUP[type]?.[water];
  if (!row) return null;
  return dealerRate ? row["Â∫Ñ"] : row["Âπ≥"];
}

  function typeLabel(t){
    return ({dao:"ËÉ°Áâå", zimo:"Ëá™Êë∏", danyou:"ÂñÆÊ∏∏", shuangyou:"ÈõôÊ∏∏"}[t] || t);
  }

  function syncWaterByType(){
  const type = $("typeSel").value;
  const input = $("waterInput");

  let v = Number(input.value || 0);
  if (!Number.isFinite(v)) v = 0;

  v = Math.max(0, Math.min(12, v));
  if ((type === "danyou" || type === "shuangyou") && v < 1) v = 1;
  input.value = String(v);

  // --- ÂñÆÊ∏∏/ÈõôÊ∏∏ÔºöËá™ÂãïÈñãÂïüÊ∏∏Èáë ---
  const isYouType = (type === "danyou" || type === "shuangyou");

  if (isYouType) {
    // Âº∑Âà∂ÂàáÂà∞„ÄåÊúâ„Äç
    if ($("youSel").value !== "yes") $("youSel").value = "yes";

    youForcedByType = true;
// ÈÅøÂÖçÊâãÊªëÊîπÂõû„ÄåÁÑ°„Äç
    $("youSel").disabled = true;
  } else {
    // ÂæûÂñÆÊ∏∏/ÈõôÊ∏∏ÂàáÂõû‰æÜÔºöËß£Èô§Âº∑Âà∂
    if (youForcedByType) {
      $("youSel").disabled = false;
      // Á≠ñÁï• BÔºö‰øùÁïô‰ΩøÁî®ËÄÖÁõÆÂâçÈÅ∏ÊìáÔºà‰∏çÂãï valueÔºâ
      youForcedByType = false;
    }
  }

  toggleYouUI();
  updateYouPill();
}

  function addRound(){
  const st0 = simulateGameState();
  if (st0.bustedIdx != null){
    alert(`Êú¨Â±ÄÂ∑≤ÁµêÁÆóÔºö${players[st0.bustedIdx]} Â∑≤Ëº∏ÂÖâÔºà0Ôºâ„ÄÇË´ãÊ∏ÖÁ©∫ÂÖ®ÈÉ®Â±ÄÊï∏/ÈñãÂßãÊñ∞Â±Ä„ÄÇ`);
    setRoundLocked(true, "Êú¨Â±ÄÂ∑≤ÁµêÁÆó");
    return;
  }

  const dealer = Number($("dealerSel").value);
  const winner = Number($("winnerSel").value);
  const type = $("typeSel").value;
  const water = Number($("waterInput").value);
  const scale = 1;

  if ((type === "danyou" || type === "shuangyou") && water === 0){
    alert("ÂñÆÊ∏∏/ÈõôÊ∏∏ÁöÑÊ∞¥=0 Âú®Ê∞¥Ë°®ÊòØÁÑ°ÊïàÔºà‚ÄîÔºâ„ÄÇË´ãÈÅ∏ 1ÔΩû12„ÄÇ");
    return;
  }

  const remain = st0.remain.slice();
  const youSelected = ($("youSel") && $("youSel").value === "yes");
  let lines = [];

  for (let i=0;i<players.length;i++){
    if (i === winner) continue;

    const raw = lookupAmount({
      type,
      water,
      dealerRate: (winner === dealer) || (i === dealer)
    });

    if (raw == null){
      alert("Êü•Ë°®Â§±ÊïóÔºöË´ãÁ¢∫Ë™çË¥èÊ≥ïËàáÊ∞¥Êï∏ÊòØÂê¶ÊúâÊïà„ÄÇ");
      return;
    }

    const owed = raw * scale;
    const pay = Math.min(owed, remain[i]);

    if (pay > 0){
      remain[i] -= pay;
      remain[winner] += pay;

      lines.push({
        from:i,
        to:winner,
        amount: pay,
        raw: (pay < owed) ? `Êü•Ë°® ${raw}ÔºàÂ∞ÅÈ†Ç ${pay}Ôºâ` : `Êü•Ë°® ${raw}`,
        role:(i===dealer ? "Â∫Ñ" : "Âπ≥")
      });
    }
  }

  if (youSelected) {
    const youWho = Number($("winnerSel").value);
    const youAmt = 10;

    for (let i = 0; i < players.length; i++) {
      if (i === youWho) continue;

      const pay = Math.min(youAmt, remain[i]);
      if (pay <= 0) continue;

      remain[i] -= pay;
      remain[youWho] += pay;

      lines.push({
        from: i,
        to: youWho,
        amount: pay,
        raw: (pay < youAmt) ? `Ê∏∏Èáë +${youAmt}ÔºàÂ∞ÅÈ†Ç ${pay}Ôºâ` : `Ê∏∏Èáë +${youAmt}`,
        role: "Ê∏∏Èáë"
      });
    }
  }

  rounds.push({dealer, winner, type, water, lines, youSelected});

  const bustedIdx = remain.findIndex(v => v <= 0);
  if (bustedIdx !== -1){
    setRoundLocked(true, `Êú¨Â±ÄÂ∑≤ÁµêÁÆóÔºö${players[bustedIdx]} Â∑≤Ëº∏ÂÖâ`);
  }

  try{
    if (typeof setYouValue === "function") setYouValue("none");
    else if ($("youSel")) $("youSel").value = "none";
    if (typeof toggleYouUI === "function") toggleYouUI();
    if (typeof updateYouPill === "function") updateYouPill();
  }catch(e){}

  renderAll();
  try{ if (typeof flashRecordBtn === "function") flashRecordBtn(); }catch(e){}
}

  function removeRound(idx){
  rounds.splice(idx,1);

  // ‚úÖ Âà™Èô§ÂñÆÂ±ÄÂæåÔºöÂêåÊ≠• UI ÁãÄÊÖãÔºåÈÅøÂÖçÊ∏∏Èáë pill / youSel ‰∏ç‰∏ÄËá¥Â∞éËá¥ badge ÂÅ∂ÁôºÂ§±Êïà
  try{ syncWaterByType(); }catch(e){}
  try{ toggleYouUI(); }catch(e){}
  try{ updateYouPill(); }catch(e){}
  try{ if (typeof syncYouSegmented === "function") syncYouSegmented(); }catch(e){}

  // ‚úÖ Âà™Èô§ÂæåÂèØËÉΩËß£Èô§„ÄåËº∏ÂÖâÁµêÁÆó„ÄçÔºåÈáçÊñ∞Âà§Êñ∑ÈéñÂÆö
  try{
    const st = simulateGameState();
    setRoundLocked(st.bustedIdx != null, st.bustedIdx != null ? `Êú¨Â±ÄÂ∑≤ÁµêÁÆóÔºö${players[st.bustedIdx]} Â∑≤Ëº∏ÂÖâ` : "");
  }catch(e){}

  renderAll();
}
  window.removeRound = removeRound;

  function computeTotals(){
  const n = players.length;
  const remain = Array(n).fill(START_STACK);
  const youRecvCount = Array(n).fill(0);
  const youRecvAmt = Array(n).fill(0);

  let bustedIdx = null;

  rounds.forEach(r=>{
    const countedYouThisRound = new Set();

    r.lines.forEach(L=>{
      const pay = Math.min(L.amount, remain[L.from]);
      if (pay <= 0) return;

      remain[L.from] -= pay;
      remain[L.to]   += pay;

      if (L.role === "Ê∏∏Èáë") {
        youRecvAmt[L.to] += pay;
        if (!countedYouThisRound.has(L.to)) {
          youRecvCount[L.to] += 1;
          countedYouThisRound.add(L.to);
        }
      }
    });

    if (bustedIdx == null){
      const idx = remain.findIndex(v => v <= 0);
      if (idx !== -1) bustedIdx = idx;
    }
  });

  const totals = remain.map(v => Math.round((v - START_STACK)*100)/100);
  return { totals, youRecvCount, youRecvAmt, remain, bustedIdx };
}

  function settleTransfers(totals){
    const creditors = [];
    const debtors = [];
    totals.forEach((amt,i)=>{
      const a = Math.round(amt*100)/100;
      if (a > 0) creditors.push({i, amt:a});
      else if (a < 0) debtors.push({i, amt:-a});
    });

    const res = [];
    let ci=0, di=0;
    while(ci<creditors.length && di<debtors.length){
      const c = creditors[ci], d = debtors[di];
      const pay = Math.min(c.amt, d.amt);
      if (pay > 0.000001) res.push({from:d.i, to:c.i, amount:pay});
      c.amt -= pay; d.amt -= pay;
      if (c.amt <= 0.000001) ci++;
      if (d.amt <= 0.000001) di++;
    }
    return res;
  }

  function badgeIf(name, should){
    return should ? `${name}<span class="badge">üü°Ê∏∏Èáë</span>` : name;
  }

  function renderRoundList(){
    if (!rounds.length){
      $("roundList").innerHTML = `<div class="muted">Â∞öÊú™Ë®òÈåÑÂ±ÄÊï∏„ÄÇ</div>`;
      return;
    }

    $("roundList").innerHTML = rounds.map((r,idx)=>{
      const youLine = r.lines.find(L => L.role === "Ê∏∏Èáë");
      const youWho = youLine ? youLine.to : null;

      // ËéäÂÆ∂Ê∞∏ÈÅ†‰∏çÈ°ØÁ§∫Ê∏∏Èáë badgeÔºàÂè™È°ØÁ§∫ÂêçÂ≠óÔºâ
const dealerName = escapeHtml(players[r.dealer]);

// badge Ê∞∏ÈÅ†Âè™Âú®Ë¥èÂÆ∂ÊóÅÈÇäÈ°ØÁ§∫ÔºàËã•Ê∏∏ÈáëËÄÖ=Ë¥èÂÆ∂ÊâçÈ°ØÁ§∫Ôºâ
const winnerName = badgeIf(escapeHtml(players[r.winner]), youWho === r.winner);

      const title = `Á¨¨ ${idx+1} Â±ÄÔΩúËéäÔºö${dealerName}ÔΩúË¥èÔºö${winnerName}ÔΩú${typeLabel(r.type)}ÔΩú${r.water} Ê∞¥`;

      const lines = r.lines.map(L=>{
        return `${escapeHtml(players[L.from])}Ôºà${escapeHtml(L.role)}Ôºâ ‚Üí ${escapeHtml(players[L.to])}Ôºö${fmtMoney(L.amount)} <span class="muted">(${escapeHtml(L.raw)})</span>`;
      }).join("<br>");

      
      const hasYou = !!r.youSelected || r.lines.some(L => L.role === "Ê∏∏Èáë");
return `
        <div class="card roundCard ${hasYou ? "isYoujin" : ""}">
          <div class="roundHeader">
            <div class="roundTitle">
              <div class="rTop"><span class="rIdx">${idx+1}.</span> <span class="rDealer">ËéäÂÆ∂:${escapeHtml(players[r.dealer])}</span></div>
              <div class="rMain">
                <span class="rWinner">${escapeHtml(players[r.winner])}</span>
                <span class="rSep">-</span>
                <span class="rWater">${r.water}Ê∞¥</span>
                <span class="rDot">¬∑</span>
                <span class="rType">${escapeHtml(typeLabel(r.type))}</span>
                ${hasYou ? '<span class="youBadge"><span class="youDot"></span>Ê∏∏Èáë</span>' : ''}
              </div>
              <div class="rSub">ËéäÂÆ∂${fmtMoney(lookupAmount({type:r.type, water:r.water, dealerRate:true}) || 0)}/Âπ≥ÂÆ∂${fmtMoney(lookupAmount({type:r.type, water:r.water, dealerRate:false}) || 0)}</div>
            </div>

            <button class="roundDelBtn" onclick="removeRound(${idx})" aria-label="Âà™Èô§Êú¨Â±Ä" title="Âà™Èô§Êú¨Â±Ä">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" style="display:block">
  <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 7h16"/>
    <path d="M10 3h4"/>
    <path d="M6 7l1 14h10l1-14"/>
    <path d="M10 11v6"/>
    <path d="M14 11v6"/>
  </g>
</svg>
            </button>
          </div>

          <div class="mono roundLines roundLinesDesktop">${lines}</div>
        </div>
      `;}).join("");
  }

  function renderTotalsAndTransfers(){
  const { totals, youRecvCount, youRecvAmt, remain, bustedIdx } = computeTotals();
  const sum = Math.round(totals.reduce((a,b)=>a+b,0)*100)/100;

  const transfers = settleTransfers(totals);

  const byWinner = new Map();
  transfers.forEach(t=>{
    if(!byWinner.has(t.to)) byWinner.set(t.to, []);
    byWinner.get(t.to).push(t);
  });

  // Â§öË¥èÂÆ∂Ôºö‰æùË¥èÊúÄÂ§öÂà∞ÊúÄÂ∞ëÊéíÂ∫èÔºåÂÖ®ÈÉ®ÂÖàÁΩÆÈ†Ç
  const winners = totals
    .map((amt,i)=>({i, amt: Math.round(amt*100)/100}))
    .filter(x=>x.amt > 0.000001)
    .sort((a,b)=>b.amt-a.amt);

  const hasWinners = winners.length > 0;

  const makeWinnerCard = (i, amt) => {
    const hasYou = youRecvCount[i] > 0 && Math.abs(youRecvAmt[i]) > 0.000001;
    const youStr = hasYou
      ? `<span class="youjinMini"><span class="youjinIcon" aria-hidden="true"></span>+${fmtMoney(youRecvAmt[i])} / ${youRecvCount[i]}Ê¨°</span>`
      : `<span>&nbsp;</span>`;

    return `
      <div class="settleCard is-winner">
        <div class="settleTop">
          <div class="settleName">${escapeHtml(players[i])}</div>
          <div class="settleAmt pos mono">+${fmtMoney(amt)}</div>
        </div>
        <div class="settleMeta">${youStr}</div>
      </div>
    `;
  };

  const makeNeutralCard = (i, amt) => {
    const cls = (amt >= 0) ? "pos" : "neg";
    const sign = (amt >= 0) ? "+" : "";
    return `
      <div class="settleCard">
        <div class="settleTop">
          <div class="settleName">${escapeHtml(players[i])}</div>
          <div class="settleAmt ${cls} mono">${sign}${fmtMoney(amt)}</div>
        </div>
        <div class="settleMeta">&nbsp;</div>
      </div>
    `;
  };

  const makeTransferCard = (t) => {
    return `
      <div class="settleCard">
        <div class="transferLine">
          <div class="transferWho">${escapeHtml(players[t.from])}</div>
          <div class="transferArrow">‚Üí</div>
          <div class="transferWho" style="text-align:right">${escapeHtml(players[t.to])}</div>
        </div>
        <div class="transferLine">
          <div class="transferSub">ËΩâÁµ¶Ë¥èÂÆ∂</div>
          <div class="transferAmt mono">-${fmtMoney(t.amount)}</div>
        </div>
      </div>
    `;
  };

  const warnHtml = (Math.abs(sum) < 0.01) ? "" : `<div class="warn">Ë≠¶ÂëäÔºöÁ∏ΩÂíå‰∏çÁÇ∫ 0ÔºàÁõÆÂâç ${fmtMoney(sum)}Ôºâ</div>`;
  const settleHtml = (bustedIdx == null) ? "" : `<div class="ok">Êú¨Â±ÄÁµêÁÆóÔºö${escapeHtml(players[bustedIdx])} Â∑≤Ëº∏ÂÖâÔºà0Ôºâ</div>`;

  // Ê≤íÊúâ‰ªª‰ΩïËº∏Ë¥èÔºöÁ∂≠ÊåÅ 4 ÂºµÊëòË¶ÅÂç°
  if(!hasWinners){
    const cards = totals.map((amt,i)=>makeNeutralCard(i, Math.round(amt*100)/100)).join("");
    $("totalsArea").innerHTML = `
      ${warnHtml}
      ${settleHtml}
      <div class="settleGrid">${cards}</div>
    `;
    setRoundLocked(bustedIdx != null, bustedIdx != null ? `Êú¨Â±ÄÂ∑≤ÁµêÁÆóÔºö${players[bustedIdx]} Â∑≤Ëº∏ÂÖâ` : "");
    $("transfersArea").innerHTML = "";
    return;
  }

  // 1) Ë¥èÂÆ∂ÁΩÆÈ†ÇÔºàÂÖ®ÈÉ®Ôºâ
  const winnerCards = winners.map(w=>makeWinnerCard(w.i, w.amt)).join("");

  // 2) ‰∏ãÈù¢ÊâçÊòØËº∏ÂÆ∂Ôºö‰æùË¥èÂÆ∂È†ÜÂ∫èÂ±ïÈñãÊØèÂÄãË¥èÂÆ∂ÁöÑÊî∂Ê¨æÊòéÁ¥∞Ôºà‰ªòÊ¨æÊñπÂç°Ôºâ
  const loserCardsArr = [];
  winners.forEach(w=>{
    const list = (byWinner.get(w.i) || []).slice().sort((a,b)=>b.amount-a.amount);
    list.forEach(t=>loserCardsArr.push(makeTransferCard(t)));
  });

  // Ëã•Êúâ‰∏≠Á´ãÁé©ÂÆ∂Ôºà0ÔºâÔºåÊîæÂà∞ÊúÄÂ∫ïÈÉ®Ôºà‰∏çÂΩ±ÈüøË¥èÂÆ∂ÁΩÆÈ†ÇÔºâ
  totals.forEach((amt,i)=>{
    const a = Math.round(amt*100)/100;
    if (Math.abs(a) <= 0.000001){
      loserCardsArr.push(makeNeutralCard(i, a));
    }
  });

  $("totalsArea").innerHTML = `
    ${warnHtml}
    ${settleHtml}
    <div class="settleGrid">${winnerCards}</div>
    ${loserCardsArr.length ? `<div class="settleGrid" style="margin-top:12px">${loserCardsArr.join("")}</div>` : ``}
  `;

  setRoundLocked(bustedIdx != null, bustedIdx != null ? `Êú¨Â±ÄÂ∑≤ÁµêÁÆóÔºö${players[bustedIdx]} Â∑≤Ëº∏ÂÖâ` : "");
  $("transfersArea").innerHTML = "";
}
  function renderAll(){
    renderRoundList();
    renderTotalsAndTransfers();
  }

  function resetAll(){
  rounds = [];
  renderSelectors();

  // ‚úÖ Êèõ‰∫∫/ÈáçÈñãÔºöÂõûÂà∞„ÄåËÉ°Áâå„ÄçÔºåËß£Èô§ÂñÆÊ∏∏/ÈõôÊ∏∏ÁöÑÊ∏∏ÈáëÂº∑Âà∂
  try{
    $("typeSel").value = "dao";
    youForcedByType = false;
    if ($("youSel")) $("youSel").disabled = false;
  }catch(e){}

  // ‚úÖ Ê∏∏ÈáëÂõûÂà∞„ÄåÁÑ°„Äç
  try{
    if (typeof setYouValue === "function") setYouValue("none");
    else if ($("youSel")) $("youSel").value = "none";
  }catch(e){}

  // ÂêåÊ≠• UI
  try{ syncWaterByType(); }catch(e){}
  try{ toggleYouUI(); }catch(e){}
  try{ updateYouPill(); }catch(e){}

  // ‚úÖ Ëß£ÈéñÊñ∞Â¢û
  try{ setRoundLocked(false); }catch(e){}

  renderAll();
}

  $("typeSel").addEventListener("change", syncWaterByType);

  $("waterMinus").addEventListener("click", ()=>{
    let v = Number($("waterInput").value || 0);
    v = Math.max(0, v - 1);
    $("waterInput").value = v;
    syncWaterByType();
  });
  $("waterPlus").addEventListener("click", ()=>{
    let v = Number($("waterInput").value || 0);
    v = Math.min(12, v + 1);
    $("waterInput").value = v;
    syncWaterByType();
  });
  $("waterInput").addEventListener("input", syncWaterByType);
  $("waterInput").addEventListener("blur", syncWaterByType);

  $("resetBtn").addEventListener("click", resetAll);
  $("addRoundBtn").addEventListener("click", addRound);
  $("clearRoundsBtn").addEventListener("click", ()=>{
  rounds = [];

  // ‚úÖ Ê∏ÖÁ©∫ÂæåÔºöÂõûÂà∞„ÄåËÉ°Áâå„ÄçÔºåËß£Èô§ÂñÆÊ∏∏/ÈõôÊ∏∏ÁöÑÊ∏∏ÈáëÂº∑Âà∂
  try{
    $("typeSel").value = "dao";
    youForcedByType = false;
    if ($("youSel")) $("youSel").disabled = false;
  }catch(e){}

  // ‚úÖ Ê∏ÖÁ©∫ÂæåÔºöÊ∏∏ÈáëÂõûÂà∞„ÄåÁÑ°„ÄçÔºàÈÅøÂÖç‰∏ã‰∏ÄÂ±Ä badge ‰∏çÈ°ØÁ§∫Ôºâ
  try{
    if (typeof setYouValue === "function") setYouValue("none");
    else if ($("youSel")) $("youSel").value = "none";
  }catch(e){}

  // ÂêåÊ≠• UI
  try{ syncWaterByType(); }catch(e){}
  try{ toggleYouUI(); }catch(e){}
  try{ updateYouPill(); }catch(e){}

  // ‚úÖ Êñ∞Â±ÄÔºöËß£Èéñ„ÄåË®òÈåÑ„Äç
  try{ setRoundLocked(false); }catch(e){}

  renderAll();
});
$("youSel").addEventListener("change", toggleYouUI);
  $("winnerSel").addEventListener("change", ()=>{
});

  renderNames();
  renderSelectors();
  initYouSegmented();
  updateYouPill();
  syncWaterByType();

  toggleYouUI();
  renderAll();

  // v5.11: subtle success feedback on record
  function flashRecordBtn(){
    const btn = document.getElementById("addRoundBtn");
    if(!btn) return;
    btn.classList.add("success");
    setTimeout(()=>btn.classList.remove("success"),120);
  }



// ===== PATCH vB15: Always auto-adjust title tracking (MutationObserver) =====
function applyTitleTracking(root=document){
  root.querySelectorAll('.roundTitle .rMain').forEach(el=>{
    const winnerEl = el.querySelector('.rWinner');
    if(!winnerEl) return;
    const name = (winnerEl.textContent || '').trim();
    const len = Array.from(name).length;

    // More noticeable but still subtle: longer name => tighter tracking
    let track = 0.10;   // px default
    if(len >= 3) track = 0.02;
    if(len >= 4) track = -0.08;
    if(len >= 5) track = -0.14;
    if(len >= 6) track = -0.20;

    el.style.setProperty('--titleTrack', `${track}px`);
  });
}

// Run once
applyTitleTracking();

// Observe round list changes so it always applies after re-render
(function(){
  const target = document.querySelector('#roundList') || document.querySelector('.roundList') || document.body;
  const obs = new MutationObserver(()=>applyTitleTracking());
  obs.observe(target, {childList:true, subtree:true});
})();

</script>
</body>
</html>
